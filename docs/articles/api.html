<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>API details â€¢ eia</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="API details">
<meta property="og:description" content="eia">
<meta property="og:image" content="https://docs.ropensci.org/eia/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">eia</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../articles/eia.html">Get Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/categories.html">Categories</a>
    </li>
    <li>
      <a href="../articles/series.html">Time series</a>
    </li>
    <li>
      <a href="../articles/geoset.html">Geosets</a>
    </li>
    <li>
      <a href="../articles/api.html">API details</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci/eia">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>API details</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/eia/blob/master/vignettes/api.Rmd"><code>vignettes/api.Rmd</code></a></small>
      <div class="hidden name"><code>api.Rmd</code></div>

    </div>

    
    
<div id="api-key" class="section level2">
<h2 class="hasAnchor">
<a href="#api-key" class="anchor"></a>API key</h2>
<div id="register-a-key-with-eia" class="section level3">
<h3 class="hasAnchor">
<a href="#register-a-key-with-eia" class="anchor"></a>Register a key with EIA</h3>
<p>Obtaining an API key is easy and free.</p>
<p>Pulling data from the US Energy Information Administration (EIA) API requires a registered API key. A key can be obtained at no cost <a href="https://www.eia.gov/opendata/register.php">here</a>. A valid email and agreement to the API Terms of Service is required to obtain a key.</p>
<p>It is important to store your API key somewhere secure. Do not commit it to a repository or otherwise share it. For example, you could store it in your <code>.Renviron</code> file.</p>
</div>
<div id="key-storage-and-retrieval" class="section level3">
<h3 class="hasAnchor">
<a href="#key-storage-and-retrieval" class="anchor"></a>Key storage and retrieval</h3>
<p>You can always provide the <code>key</code> argument to every API function call, but you do not have to. There are getter and setter helpers available to make using <code>eia</code> functions a more seamless experience.</p>
<p><code>eia_set_key</code> gives you the option of storing your key in any of three places via the <code>store</code> argument:</p>
<ul>
<li>
<code>store = "env"</code>: the package environment that is created when the package is loaded (default method)</li>
<li>
<code>store = "options"</code>: in the global <code>options</code>
</li>
<li>
<code>store = "sysenv"</code>: as a system environment variable via <code>Sys.setenv</code>.</li>
</ul>
<p>The last two options require the name-value pair to be named <code>EIA_KEY = "yourkey"</code>. These three options also are the order of precedence if you do not specify the <code>store</code> argument.</p>
<p>This setup also allows you to store a key that will override another key. This is because <code>eia_get_key</code> checks these three storage methods in this order and stops as soon as it finds a key. If you need it to check a specific location, you can specify <code>store</code>.</p>
<p>As an example, if the key already exists in the system environment and you plan to pass <code>key</code> to functions explicitly, you could start as follows:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">eia</span>)
<span class="no">key</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"EIA_KEY"</span>)

<span class="co"># or:</span>
<span class="no">key</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/eia_key.html">eia_get_key</a></span>()</pre></body></html></div>
<p>If you need to set it, you can do so as follows.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"># eia_set_key("yourkey")
# eia_get_key() # retrieve it</pre></body></html></div>
<p>API functions in <code>eia</code> use <code><a href="../reference/eia_key.html">eia_get_key()</a></code> with no arguments as the default value of their <code>key</code> argument, checking in the order shown above for an existing key. This way you do not need to repeatedly provide it.</p>
<p>Note that despite the name and behavior, storing an environment variable with <code>Sys.setenv</code> (and thus <code><a href="../reference/eia_key.html">eia_set_key(key, store = "sysenv")</a></code>) is not persistent; the key is lost when the R session terminates, just as it is with the other two session-based options. If you want a persistent key, you must manually add your key somewhere like <code>.Renviron</code>. In that cases, you never need <code>eia_set_key</code> and <code>eia_get_key</code> will retrieve the <code>EIA_KEY</code> environment variable. See the package documentation for more details on key options.</p>
<p>In this and subsequent vignettes, you will not see a key being set because it is already an environment variable. You will also not see it used explicitly by any functions because the default behavior is to look up the key in the environment.</p>
</div>
</div>
<div id="api-requests" class="section level2">
<h2 class="hasAnchor">
<a href="#api-requests" class="anchor"></a>API requests</h2>
<p>The EIA API can of course impose its own rate-limiting and other limitations on usage by a given API key. If you use the API improperly or otherwise violate any Terms of Service, the EIA may withdraw your API access. However, the <code>eia</code> package also helps prevent accidental overuse by having default settings that limit the potential for making unnecessary API calls. It does this in two ways, both of which allow optional configuration:</p>
<ul>
<li>caching API results in memory using session-based memoization</li>
<li>minimum delay between API calls</li>
</ul>
<p>By default the <code>eia</code> package prevents you from accidentally making too many requests too quickly, but it also offers sensible flexibility.</p>
<div id="memoization" class="section level3">
<h3 class="hasAnchor">
<a href="#memoization" class="anchor"></a>Memoization</h3>
<p>All functions in <code>eia</code> that make API calls use memoization by default. They will not make the same API call twice in one R session. A call is made once and the result is cached. Calling the same function with the identical arguments again will only returned the cached result.</p>
<p>This approach limits the potential for accidentally using the EIA API more than necessary. This is fine for most uses cases. However, if you use your API key to access data that is updated very often, or you have a long-running R process such as a Shiny app on a server that may need to periodically update the data associated with a specific API call, you can set <code>cache = FALSE</code>.</p>
<p>Run this example of the same request made with and without memoization. You will notice the cached result by the immediate return.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(<span class="fu"><a href="../reference/eia_cats.html">eia_cats</a></span>()) <span class="co"># API call; cache result</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(<span class="fu"><a href="../reference/eia_cats.html">eia_cats</a></span>()) <span class="co"># read from cache</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(<span class="fu"><a href="../reference/eia_cats.html">eia_cats</a></span>(<span class="kw">cache</span> <span class="kw">=</span> <span class="fl">FALSE</span>)) <span class="co"># API call</span></pre></body></html></div>
<p>Results are cached in memory for the duration of the R session, but you can clear the cache at any time.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="../reference/eia_clear_cache.html">eia_clear_cache</a></span>()
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(<span class="fu"><a href="../reference/eia_cats.html">eia_cats</a></span>())</pre></body></html></div>
<p>This allows you to update the cached result. You can reset the cache for only specific endpoints using the following functions.</p>
<ul>
<li><code>eia_clear_cats</code></li>
<li><code>eia_clear_series</code></li>
<li><code>eia_clear_geoset</code></li>
</ul>
</div>
<div id="anti-dos-measures" class="section level3">
<h3 class="hasAnchor">
<a href="#anti-dos-measures" class="anchor"></a>Anti-DOS measures</h3>
<p>Regardless of overall rate limiting imposed by the EIA API, the <code>eia</code> package sets a minimum wait time of one second between successive API calls. In most cases this is an irrelevant safeguard. Most <code>eia</code> functions make a single API call and requests for data often take a full second anyway once you factor in the subsequent data manipulation in R.</p>
<p>However, there are cases where you might want to make multiple calls back to back programmatically and perhaps you are initially unsure how many requests will be made or how quickly these requests may execute. The default minimum wait between API calls is a precaution that helps you be a good neighbor.</p>
<p>You can turn this off with <code>options</code> if not needed; for example, a case where you know that your API calls will be small in number and you have no reason to be concerned about exceeding the request limits associated with your API key. The default requires you to make an active decision about how to use the API with your own key and API limits in mind.</p>
<p>A call to <code>eia_parent_cats</code> is a good example. This function is recursive, but say you know the number of calls is going to be small; it is overkill to impose the additional wait. Note that in order to show this example, it is necessary to turn off memoization to avoid returning a cached result.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/eia_cats.html">eia_parent_cats</a></span>(<span class="fl">742</span>, <span class="kw">cache</span> <span class="kw">=</span> <span class="fl">FALSE</span>))
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;    0.14    0.04    6.73</span>

<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="kw">eia_antidos</span> <span class="kw">=</span> <span class="fl">0</span>)
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/eia_cats.html">eia_parent_cats</a></span>(<span class="fl">742</span>, <span class="kw">cache</span> <span class="kw">=</span> <span class="fl">FALSE</span>))
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;    0.02    0.00    1.05</span>

<span class="no">x</span>
<span class="co">#&gt; # A tibble: 6 x 4</span>
<span class="co">#&gt;   category_id name                    notes parent_category_id</span>
<span class="co">#&gt; * &lt;chr&gt;       &lt;chr&gt;                   &lt;chr&gt; &lt;chr&gt;             </span>
<span class="co">#&gt; 1 371         EIA Data Sets           ""    &lt;NA&gt;              </span>
<span class="co">#&gt; 2 0           Electricity             ""    371               </span>
<span class="co">#&gt; 3 32          Total consumption (Btu) ""    0                 </span>
<span class="co">#&gt; 4 372         By sector               ""    32                </span>
<span class="co">#&gt; 5 389         Electric utility        ""    372               </span>
<span class="co">#&gt; 6 742         Coal                    ""    389</span></pre></body></html></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/leonawicz">Matthew Leonawicz</a>, <a href="https://www.esource.com/"><img src="https://raw.githubusercontent.com/leonawicz/leonawicz.github.io/master/assets/img/esource_logo.png" height="24"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
